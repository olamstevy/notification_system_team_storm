generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model notification {
  id                String   @id @default(uuid())
  notification_type NotificationType
  user_id           String
  template_code     String
  variables         Json
  request_id        String   @unique
  priority          Int      @default(5)
  metadata          Json?
  status            NotificationStatus @default(pending)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  status_history notification_status[]
}

model notification_status {
  id              String   @id @default(uuid())
  notification_id String
  status          NotificationStatus
  timestamp       DateTime @default(now())
  error           String?

  notification notification @relation(fields: [notification_id], references: [id], onDelete: Cascade)

  @@index([notification_id])
}

enum NotificationType {
  email
  push
}

enum NotificationStatus {
  pending
  delivered
  failed
}
